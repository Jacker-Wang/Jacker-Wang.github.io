# 添加yarn队列

配置YARN队列调度策略：

（1）配置项(此项可以在ambari上面yarn的customer yarn-site中配置)：
```
yarn.resourcemanager.scheduler.class
```
值：
```
org.apache.hadoop.yarn.server.resourcemanager.scheduler.fair.FairScheduler
```
（2）配置项(此项可以在ambari上面yarn的customer yarn-site中配置)：
```
yarn.scheduler.fair.allocation.file
```
值：
```
/etc/hadoop/conf/fair-scheduler.xml
```
3.创建YARN队列配置文件：

在YARN所有ResourceManager主机/etc/hadoop/conf/下创建文件fair-scheduler.xml与mapred-queues.xml，内容示例如下。

default是默认队列，下面的配置添加了alogic队列

（1）fair-scheduler.xml
内容示例：
```
<?xml version="1.0"?>
<allocations>
  <queue name="default">
    <minResources>6000 mb,0vcores</minResources>
    <schedulingPolicy>fair</schedulingPolicy>
    <aclAdministerApps>default</aclAdministerApps>
  </queue>
  <queue name="alogic">
    <minResources>6000 mb,0vcores</minResources>
    <schedulingPolicy>fair</schedulingPolicy>
    <aclAdministerApps>default</aclAdministerApps>
  </queue>
</allocations>
```
（2）mapred-queues.xml
```
<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<queues>
  <queue>
    <name>default</name>
    <state>running</state>
    <acl-submit-job> </acl-submit-job>
    <acl-administer-jobs> </acl-administer-jobs>
  </queue>
  <queue>
    <name>alogic</name>
    <state>running</state>
    <acl-submit-job>alogic</acl-submit-job>
    <acl-administer-jobs>alogic,hue</acl-administer-jobs>
   </queue>
</queues>
```

若需要添加YARN队列，则在/etc/hadoop/conf/fair-scheduler.xm中中仿照示例添加<queue>标签内容。并且在/etc/hadoop/conf/mapred-queues.xml中添加相关队列。

# HA状态下的namenode格式化

1 停止所有namenode（stanby namenode和active namenode）

2 删除所有主机的datanode数据目录和namenode目录

3 开启所有的Journalnode服务

4 格式化zkfc

注意这里格式化所有的azfc（一般是2台）
```
  hdfs zkfc -formatZK
```

5 格式化namenode

 ```
  hdfs namenode -format
 ```

 6 拷贝namenode文件导另外一台namenode

    拷贝目录/~/hadoop/hdfs/namenode下面的所有文件。

 7 启动namenode

# 增加Journalnode

 1  为增加Journalnode分配角色

```
     curl -u admin:admin -H "X-Requested-By: Ambari" -X POST http://10.251.44.62:8181/api/v1/clusters/wss_cluster/hosts/s4.wss.com/host_components/JOURNALNODE

```
2  安装Journalnode
```
curl -u admin:admin -H 'X-Requested-By: Ambari' -X PUT -d '{"RequestInfo":{"context":"Install JournalNode"},"Body":{"HostRoles":{"state":"INSTALLED"}}}' http://10.251.44.62:8181/api/v1/clusters/wss_cluster/hosts/s4.wss.com/host_components/JOURNALNODE
```

3 更新hdfs的配置

    搜索配置项 dfs.namenode.shared.edits.dir ，添加新增的Journalnode主机和端口

4  创建Journalnode目录

    搜索配置项 dfs.journalnode.edits.dir ，查看对应的目录，然后创建目录。 搜索配置项 dfs.nameservices的值，在上一步创建的目录下面创建一个目录，目录名为这个值。

5 修改刚刚创建的目录的权限

  具体权限可以根据服务正常的Journalnode相应目录的权限修改

6 同步数据

  将服务正常的Journalnode目录下面的current目录中的所有文件拷贝过来，然后修改权限。

7 启动Ambari

   在Ambari界面启动新添加的Journalnode，然后查看日志。
